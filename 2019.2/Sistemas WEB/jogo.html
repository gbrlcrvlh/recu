<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Jogo pula pula</title>

    <style>
        canvas {
            position: absolute;
            top: 0px;
            bottom: 0px;
            left: 0px;
            right: 0px;
            margin: auto;
        }
        
    </style>
</head>
<body>
    <script>
    var canvas, ctx, ALTURA, LARGURA, frames = 0, maxPulos = 3, velocidade = 6,
    
    estadoAtual = 0
	
    estados = {
        jogar: 0,
        jogando: 1,
        perdeu: 2
    }

    var chao = {
        y: 550,
        altura: 50,
        cor: "#ffdf70",

        desenha: function() {
            ctx.fillStyle = this.cor
            ctx.fillRect(0, this.y, LARGURA, this.altura)
        }
        
    }

    var bloco = {
        y: 0,
        x: 50,
        altura: 50,
        largura: 50,
        cor: "#ff9239",
        qntPulos: 0,
        forcaPulo: 23,
        
        gravidade: 1.6,
        velocidade: 0,

        atualiza: function () {
            this.velocidade += this.gravidade
            this.y += this.velocidade

            if(this.y > chao.y - this.altura) {
                this.y = chao.y - this.altura //limite do chao
                this.qntPulos = 0 //encosta no chao zera pulos
            }
			
			return [this.x, this.y]
        },

        pula: function () {
            if(this.qntPulos < maxPulos) {
                this.velocidade = -this.forcaPulo
                this.qntPulos++
            }
        },

        desenha: function() {
            ctx.fillStyle = this.cor
            ctx.fillRect(this.x, this.y, this.largura, this.altura)
        }
    }

    var obstaculos = {
        _obs: [],
        cores: ["#ffbc1c", "#ff1c1c", "#ff85e1", "#52a7ff", "#50beff"],

        tempoInsere: 0,

        insere: function () {
            this._obs.push({
                x: LARGURA ,
                altura: 30 + Math.floor(Math.random() * 120),
                largura: 30 + Math.floor(Math.random() * 20),
                cor: this.cores[Math.floor(Math.random() * this.cores.length)]
            })
            this.tempoInsere = 35 + Math.floor(Math.random() * 35)
        }, 

        atualiza: function(playerPos) {
            if(this.tempoInsere == 0)
                this.insere()
            else
                this.tempoInsere--

            this._obs.forEach((obj, i)=>{
                obj.x -= velocidade

                if(obj.x < -obj.largura) {
                    this._obs.splice(i, 1)
                }
				
				if(obj.x < 100){
					if(obj.x+obj.largura > 50){
						if(playerPos[1]+50 > chao.y - obj.altura - 1){
							playerPos[0] = 1
						}
					}
				}
            })
      
        },


        desenha: function() {

            for(var i = 0, tam = this._obs.length; i < tam; i++) {
                var obj = this._obs[i]
                ctx.fillStyle = obj.cor
                ctx.lineWidth = 1
                ctx.strokeStyle = "black"
                ctx.strokeRect(obj.x, chao.y - obj.altura - 1, obj.largura, obj.altura)
                ctx.fillRect(obj.x, chao.y - obj.altura -1, obj.largura, obj.altura)
            }

        }
    }



    function main() {
        ALTURA = window.innerHeight
        LARGURA = window.innerWidth
		playerPos = [0,0]
		colisor = 0
		
        if(LARGURA >= 500) {
            LARGURA = 600
            ALTURA = 600
        }

        canvas = document.createElement("canvas") 
        canvas.width = LARGURA
        canvas.height = ALTURA
        canvas.style.border = "1px solid #000"

        ctx = canvas.getContext("2d")    
        
        document.body.appendChild(canvas) 

        //adicionar evento de clique
        document.addEventListener("mousedown", clique)

        roda()  
    }

    function clique(event) {
		if(estadoAtual == 0){
		   estadoAtual = 1
	   }else if(estadoAtual == 1){
			bloco.pula()
	   }else{
		   bloco.y = 0
		   bloco.velocidade = 0
		   obstaculos._obs = []
		   //playerPos[0] = 0
		   estadoAtual = 0
	   }
    }

   function desenha() {
       ctx.fillStyle = "#50beff"
       ctx.fillRect(0,0,LARGURA,ALTURA)
       chao.desenha()
       obstaculos.desenha()
       bloco.desenha()
	   if(estadoAtual == 0){
		   ctx.fillStyle = "#7cc576";
		   ctx.beginPath();
		   ctx.moveTo(250, 200);
		   ctx.lineTo(250, 300);
		   ctx.lineTo(350, 250);
		   ctx.fill();
	   }else if(estadoAtual == 1){
	
	   }else{
		   ctx.fillStyle = "#ff3333"
		   ctx.fillRect(250,200,100,100)
	   }
    }

    function roda() {
		if(estadoAtual == 0){
			desenha()
		}else if(estadoAtual == 1){
			atualiza()
			desenha()
			if(playerPos[0] == 1){
				estadoAtual = 2
			}
		}else{
			desenha()
		}
		window.requestAnimationFrame(roda)
    }

    function atualiza() {
        frames++
		playerPos = bloco.atualiza()
        obstaculos.atualiza(playerPos)
    }

    main()


    </script>
</body>

</html>